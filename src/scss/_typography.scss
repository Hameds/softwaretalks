@use "sass:map";
@use "math";

$base-font-size: 17px;
$base-line-height: math.ratio(phi);
$font-families: (
  en: (
    'Poppins',
    sans-serif,
  ),
  fa: 'Iran Yekan',
);

@use "rfs/scss" as * with (
  $rfs-base-value: 12px,
  $rfs-unit: rem,
  $rfs-breakpoint: 1920px,
  $rfs-breakpoint-unit: px,
  $rfs-factor: 2,
  $rfs-rem-value: math.strip-unit($base-font-size),
);

/// Font family helper function as a specific wrap arround map-get for $font-families map
///
/// @group Typography
/// @author Mohammad Hasani
///
/// @parameter {String} $key - A key of $font-families map
/// @return {String | List} A font family or a list of fomt families based on $font-families map
@function font-family($key) {
  @if map.has-key($font-families, $key) {
    @return map.get($font-families, $key);
  }

  @error "Unknown key '#{$key}' in $font-families map.";
}

/// Convert other units to EM unit
///
/// @group Typography
/// @author Mohammad Hasani
///
/// @parameter {Number} $target - The target value
/// @parameter {Number} $base [$base-font-size] - The base value
/// @return {Number} The converted value to EM unit
@function em($target, $base: $base-font-size) {
  @if (math.is-unitless($target)) {
    $target: $target * 1px;
  }

  @if (math.is-unitless($base)) {
    $base: $base * 1px;
  }

  @return #{$target / $base}em;
}

/// Get rid of pesky space above and below a block of text due to line height
///
/// @group Typography
/// @author Mohammad Hasani
/// @link https://text-crop.eightshapes.com
///
/// @parameter {Number} $line-height [$base-line-height] - Desired line height
/// @parameter {Number} $top-adjustment [0px] - Top adjustment
/// @parameter {Number} $bottom-adjustment [0px] - Bottom adjustment
/// @output Text block without pesky space!
@mixin poppins-extrabold-text-crop(
  $line-height: $base-line-height,
  $top-adjustment: 0px,
  $bottom-adjustment: 0px
) {
  // Configured in Step 1
  $top-crop: 8.5;
  $bottom-crop: 9;
  $crop-font-size: 36;
  $crop-line-height: 1.2;

  // Apply values to calculate em-based margins that work with any font size
  $dynamic-top-crop: max(
      ($top-crop + ($line-height - $crop-line-height) * ($crop-font-size / 2)),
      0
    ) / $crop-font-size;
  $dynamic-bottom-crop: max(
      (
        $bottom-crop + ($line-height - $crop-line-height) *
          ($crop-font-size / 2)
      ),
      0
    ) / $crop-font-size;

  // Mixin output
  line-height: $line-height;

  &::before,
  &::after {
    content: '';
    display: block;
    height: 0;
    width: 0;
  }

  &::before {
    margin-bottom: calc(-#{$dynamic-top-crop}em + #{$top-adjustment});
  }

  &::after {
    margin-top: calc(-#{$dynamic-bottom-crop}em + #{$bottom-adjustment});
  }
}

/// Text antialiasing
///
/// @group Typography
/// @author Mohammad Hasani
///
/// @output Platform compatible text antializing CSS properties
@mixin font-smoothing {
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-smoothing: antialiased;
}

:root {
  @include font-smoothing;

  font-size: $base-font-size;
  line-height: $base-line-height;
  // Unfortunately postcss-font-magician plugin just loads the first font declared in font-family CSS property.
  // So as a workarround for this limitation we can define multiple times font-family CSS property
  // with different font we want to be load by postcss-font-magician.
  font-family: font-family(en);
  font-family: font-family(fa);
  // The intentional font-family CSS property.
  font-family: font-family(en), font-family(fa);
}

$text-scale-steps: (
  -2: 10px,
  -1: 14px,
  1: 24px,
  2: 32px,
  3: 40px,
  4: 48px,
  5: 56px
);

.o-text {
  @include rfs($base-font-size);

  margin: 0;
}

$text-scale-down-modifier: 'down';
$text-scale-up-modifier: 'up';

@each $step, $font-size in $text-scale-steps {
  $modifier: if($step < 0, $text-scale-down-modifier, $text-scale-up-modifier);
  $scale: math.abs($step);

  .o-text--#{$modifier}-#{$scale} {
    @include rfs($font-size);
  }
}
